<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-05-02 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Waiting for I/O in C</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Pushkar Raj">
<link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/style.css"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/fonts.css"/> 
<script type="text/javascript" src="/assets/js/script.js" defer></script> 
</head>
<body>
<header id="preamble" class="status">
<div class="container">
  <div class="user-info">
    <img alt="Profile Picture" src="https://avatars.githubusercontent.com/u/86090336"/>
    <a class="user-name" href="/">Pushkar Raj</a>
    <div id="toggler"></div>
  </div>
  <nav>
    <ul>
      <li><a href="/about.html">About</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li><a href="/articles">All Articles</a></li>
      <li><a href="/til">Today I Learnt</a></li>
      <li><a href="https://github.com/px86">My Github</a></li>
    </ul>
  </nav>
  <!-- Use CSS and JS to place this date below the post heading. -->
  <div id="date"><span class="timestamp">2023-04-30</span></div>
</div>
</header>
<main id="content">
<header>
<h1 class="title">Waiting for I/O in C</h1>
<p class="subtitle">the 'select' function</p>
</header><p>
The <code>select</code> function can be used to implement an input method where the function call blocks until data is available or until the time expires, whichever comes first.
</p>

<p>
<a href="https://www.gnu.org/software/libc/manual/html_node/Waiting-for-I_002fO.html">https://www.gnu.org/software/libc/manual/html_node/Waiting-for-I_002fO.html</a>
</p>

<div class="org-src-container">
<pre class="src src-c"><span class="org-preprocessor">#include</span> <span class="org-string">&lt;errno.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;stdio.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;sys/time.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;sys/types.h&gt;</span>
<span class="org-preprocessor">#include</span> <span class="org-string">&lt;unistd.h&gt;</span>

<span class="org-type">int</span> <span class="org-function-name">input_timeout</span>(<span class="org-type">int</span> <span class="org-variable-name">filedes</span>, <span class="org-type">unsigned</span> <span class="org-type">int</span> <span class="org-variable-name">seconds</span>) {
  <span class="org-type">fd_set</span> <span class="org-variable-name">set</span>;
  <span class="org-keyword">struct</span> <span class="org-type">timeval</span> <span class="org-variable-name">timeout</span>;

  <span class="org-comment-delimiter">/* </span><span class="org-comment">Initialize the file descriptor set.</span><span class="org-comment-delimiter"> */</span>
  FD_ZERO(&amp;set);
  FD_SET(filedes, &amp;set);

  <span class="org-comment-delimiter">/* </span><span class="org-comment">Initialize the timeout data structure.</span><span class="org-comment-delimiter"> */</span>
  timeout.tv_sec = seconds;
  timeout.tv_usec = 0;

  <span class="org-comment-delimiter">/* </span><span class="org-comment">select returns 0 if timeout, 1 if input available, -1 if error.</span><span class="org-comment-delimiter"> */</span>
  <span class="org-type">int</span> <span class="org-variable-name">available</span>;
  <span class="org-keyword">while</span> ((available = select(FD_SETSIZE, &amp;set, <span class="org-constant">NULL</span>, <span class="org-constant">NULL</span>, &amp;timeout)) == -1) {
    <span class="org-keyword">if</span> (errno != EINTR) {
      <span class="org-keyword">break</span>;
    }
  }

  <span class="org-keyword">return</span> available;
}

<span class="org-type">int</span> <span class="org-function-name">main</span>(<span class="org-type">void</span>) {
  <span class="org-type">int</span> <span class="org-variable-name">available</span> = input_timeout(STDIN_FILENO, 5);
  <span class="org-keyword">if</span> (available == 1) {
    <span class="org-type">char</span> <span class="org-variable-name">buff</span>[1024];
    <span class="org-type">int</span> <span class="org-variable-name">rcount</span> = read(STDIN_FILENO, &amp;buff, 1024);
    buff[--rcount] = 0;
    fprintf(stdout, <span class="org-string">"%s\n"</span>, buff);
  } <span class="org-keyword">else</span> {
    fprintf(stderr, <span class="org-string">"No input provided.\n"</span>);
  }

  <span class="org-keyword">return</span> 0;
}
</pre>
</div>

<p>
This example is taken from the <code>glibc</code> manual. They used the <code>TEMP_FAILURE_RETRY</code> macro. I was getting some errors. I will get back to it!
</p>
</main>
<footer id="postamble" class="status">
<p class="footer-block">
  Copyright &copy 2021-2023 Pushkar Raj. Read the notice about <a href="/license.html">license terms</a>.
</p>
<p class="footer-block">
  Created using <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3)
</p>
</footer>
</body>
</html>
