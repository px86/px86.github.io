<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-05-04 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Python singledispatch decorator</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Pushkar Raj">
<link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/style.css"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/fonts.css"/> 
<script type="text/javascript" src="/assets/js/script.js" defer></script> 
</head>
<body>
<header id="preamble" class="status">
<div class="container">
  <div class="user-info">
    <img alt="Profile Picture" src="https://avatars.githubusercontent.com/u/86090336"/>
    <a class="user-name" href="/">Pushkar Raj</a>
    <div id="toggler"></div>
  </div>
  <nav>
    <ul>
      <li><a href="/about.html">About</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li><a href="/articles">All Articles</a></li>
      <li><a href="/til">Today I Learnt</a></li>
      <li><a href="https://github.com/px86">My Github</a></li>
    </ul>
  </nav>
  <!-- Use CSS and JS to place this date below the post heading. -->
  <div id="date"><span class="timestamp">2023-05-03</span></div>
</div>
</header>
<main id="content">
<header>
<h1 class="title">Python singledispatch decorator</h1>
<p class="subtitle">transform a function into a generic single-dispatcher</p>
</header><p>
Today, I came to know about the <code>singledispatch</code> decorator from the <code>functools</code> module. It transforms a function into a generic single dispatch function. The function then dispatches to other functions,  based on the type of its first argument.
</p>

<p>
It will be clearer with examples.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> functools <span class="org-keyword">import</span> singledispatch

<span class="org-type">@singledispatch</span>
<span class="org-keyword">def</span> <span class="org-function-name">foo</span>(arg):
    <span class="org-doc">"""Default implementation."""</span>
    <span class="org-keyword">print</span>(f<span class="org-string">"This is the default implementation: {arg}"</span>)
</pre>
</div>

<p>
Now we can <i>register</i> specific implementations of <code>foo</code> based on type of <code>arg</code>.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-type">@foo.register</span>
<span class="org-keyword">def</span> <span class="org-function-name">_</span>(arg: <span class="org-builtin">int</span>):
    <span class="org-doc">"""Implementation of foo for int type."""</span>
    <span class="org-variable-name">twice</span> = 2 * arg
    <span class="org-keyword">print</span>(f<span class="org-string">"twice of {arg} is {twice}."</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">notice how arg type can also be passed inside @foo.register(...)</span>
<span class="org-type">@foo.register</span>(<span class="org-builtin">str</span>)
<span class="org-keyword">def</span> <span class="org-function-name">_</span>(arg):
    <span class="org-doc">"""Implementation of foo for str type."""</span>
    <span class="org-keyword">print</span>(f<span class="org-string">"length of '{arg}' is {len(arg)}."</span>)


foo(10)     <span class="org-comment-delimiter"># </span><span class="org-comment">Output: twice of 10 is 20.</span>
foo(<span class="org-string">"abc"</span>)  <span class="org-comment-delimiter"># </span><span class="org-comment">Output: length of 'abc' is 3.</span>
foo(<span class="org-constant">None</span>)   <span class="org-comment-delimiter"># </span><span class="org-comment">Output: This is the default implementation: None</span>
</pre>
</div>

<p>
<code>register</code> returns the undecorated function, so it is possible to stack multiple <i>register</i> decorations on top of each-other.
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">class</span> <span class="org-type">Pet</span>:
    <span class="org-keyword">pass</span>

<span class="org-keyword">class</span> <span class="org-type">Cat</span>(Pet):
    <span class="org-keyword">pass</span>

<span class="org-keyword">class</span> <span class="org-type">Dog</span>(Pet):
    <span class="org-keyword">pass</span>

<span class="org-keyword">class</span> <span class="org-type">Snake</span>(Pet):
    <span class="org-keyword">pass</span>

<span class="org-type">@foo.register</span>(Pet)
<span class="org-keyword">def</span> <span class="org-function-name">_</span>(arg):
    <span class="org-keyword">print</span>(<span class="org-string">"Not Implemented"</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">decorator stacking, because register returns the undecorated function</span>
<span class="org-type">@foo.register</span>(Dog)
<span class="org-type">@foo.register</span>(Cat)
<span class="org-keyword">def</span> <span class="org-function-name">_</span>(arg):
    <span class="org-keyword">print</span>(f<span class="org-string">"Cool..."</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">lambdas, or predefined functions can be registered in this way</span>
foo.register(Snake, <span class="org-keyword">lambda</span> arg: <span class="org-keyword">print</span>(<span class="org-string">"Not cool.."</span>))
</pre>
</div>


<p>
To check which function will be called for a given type, we can use the <code>dispatch</code> attribute. <i>This would have been more useful if we had named our functions differently</i>. ðŸ˜…
</p>

<div class="org-src-container">
<pre class="src src-python">foo.dispatch(<span class="org-builtin">int</span>)  <span class="org-comment-delimiter"># </span><span class="org-comment">&lt;function _ at 0x7ff8f3c07f70&gt;</span>
foo.dispatch(<span class="org-builtin">str</span>)  <span class="org-comment-delimiter"># </span><span class="org-comment">&lt;function _ at 0x7ff8f3c21040&gt;</span>
</pre>
</div>

<p>
The <code>registry</code> attribute will return all the registered types and their corresponding functions.
</p>

<p>
Also, we can use <code>singledispatchmethod</code> on class methods to convert them into a generic single dispatchers. It will dispatch based on the first <i>non-self</i>, or <i>non-cls</i> argument.
</p>


<p>
<b>RESOURCE</b>: <a href="https://docs.python.org/3/library/functools.html">https://docs.python.org/3/library/functools.html</a>
</p>
</main>
<footer id="postamble" class="status">
<p class="footer-block">
  Copyright &copy 2021-2023 Pushkar Raj. Read the notice about <a href="/license.html">license terms</a>.
</p>
<p class="footer-block">
  Created using <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3)
</p>
</footer>
</body>
</html>
