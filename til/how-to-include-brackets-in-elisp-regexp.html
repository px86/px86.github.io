<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-05-01 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>How to include brackets [] in elisp regexp</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Pushkar Raj">
<link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/style.css"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/fonts.css"/> 
<script type="text/javascript" src="/assets/js/script.js" defer></script> 
</head>
<body>
<header id="preamble" class="status">
<div class="container">
  <div class="user-info">
    <img alt="Profile Picture" src="https://avatars.githubusercontent.com/u/86090336"/>
    <a class="user-name" href="/">Pushkar Raj</a>
    <div id="toggler"></div>
  </div>
  <nav>
    <ul>
      <li><a href="/about.html">About</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li><a href="/articles">All Articles</a></li>
      <li><a href="/til">Today I Learnt</a></li>
      <li><a href="https://github.com/px86">My Github</a></li>
    </ul>
  </nav>
  <!-- Use CSS and JS to place this date below the post heading. -->
  <div id="date"><span class="timestamp">2023-05-01</span></div>
</div>
</header>
<main id="content">
<header>
<h1 class="title">How to include brackets [] in elisp regexp</h1>
<p class="subtitle">escaping <code>\]</code> doesn't work</p>
</header><p>
Today I was trying to write an elisp function that converts a given string into a normalized filename. The idea was to remove all the special characters, replace the spaces with dashes <code>-</code>, and lower-case the entire thing.
</p>

<p>
I was using the <code>split-string</code> function to split the given string by a regexp of special characters. I tried to include brackets into the regexp by escaping the closing bracket <code>\]</code>, like below, but it was not giving the expected result.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(string-split <span class="org-string">"[a] b"</span>
              <span class="org-string">"[ [</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">]]"</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Output: ("[a] b")</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">I need: ("a" "b")</span>
</pre>
</div>

<p>
Then I found <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Regexp-Example.html">this example</a> in the emacs manual. It uses the closing bracket <code>]</code> as the first character inside <code>[...]</code>, like below,
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(string-split <span class="org-string">"[a] b"</span>
              <span class="org-string">"[][ ]"</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Output: ("a" "b")</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">It worked!</span>
</pre>
</div>

<p>
So, I ended up writing the below function for normalizing strings for filenames.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my-normalize-string-for-filename</span> (string)
  <span class="org-doc">"Downcase and remove special charactes from string."</span>
  (downcase (string-join
             (split-string string
                           <span class="org-string">"[] ~!@#$%^&amp;*()+={}[</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">/;:,.'\"&lt;&gt;?]+"</span> t
                           <span class="org-string">"[ _-]"</span>)
             <span class="org-string">"-"</span>)))
</pre>
</div>
</main>
<footer id="postamble" class="status">
<p class="footer-block">
  Copyright &copy 2021-2023 Pushkar Raj. Read the notice about <a href="/license.html">license terms</a>.
</p>
<p class="footer-block">
  Created using <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3)
</p>
</footer>
</body>
</html>
