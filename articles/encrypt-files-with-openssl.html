<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2023-04-30 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Encrypt Files with OpenSSL</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Pushkar Raj">
<link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/style.css"/> 
<link rel="stylesheet" type="text/css" href="/assets/css/fonts.css"/> 
<script type="text/javascript" src="/assets/js/script.js" defer></script> 
</head>
<body>
<header id="preamble" class="status">
<div class="container">
  <div class="user-info">
    <img alt="Profile Picture" src="https://avatars.githubusercontent.com/u/86090336"/>
    <a class="user-name" href="/">Pushkar Raj</a>
    <div id="toggler"></div>
  </div>
  <nav>
    <ul>
      <li><a href="/about.html">About</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li><a href="/articles">All Articles</a></li>
      <li><a href="/til">Today I Learnt</a></li>
      <li><a href="https://github.com/px86">My Github</a></li>
    </ul>
  </nav>
  <!-- Use CSS and JS to place this date below the post heading. -->
  <div id="date"><span class="timestamp">2022-09-04</span></div>
</div>
</header>
<main id="content">
<header>
<h1 class="title">Encrypt Files with OpenSSL</h1>
<p class="subtitle">a basic demonstration of symmetric encryption</p>
</header><p>
<a href="https://www.openssl.org/">OpenSSL</a> is a software toolkit for general purpose cryptography and secure communication. On GNU/Linux systems, we can leverage the features of OpenSSL using the <code>openssl</code> command line tool.
</p>

<p>
Let's get started!
</p>

<div id="outline-container-orgad62a8f" class="outline-2">
<h2 id="orgad62a8f">Setup</h2>
<div class="outline-text-2" id="text-orgad62a8f">
<p>
Most probably, the openssl tool would already be installed on your system. You can verify this by running the following command in your shell,
</p>

<div class="org-src-container">
<pre class="src src-shell">openssl version
</pre>
</div>

<p>
If <code>openssl</code> is installed, then the output will look something like this,
</p>

<div class="org-src-container">
<pre class="src src-text">OpenSSL 1.1.1n  15 Mar 2022
</pre>
</div>

<p>
If you get an error saying <code>command not found</code>, then you need to install the <i>openssl</i> package. On debian based systems, you can install it with the following command,
</p>

<div class="org-src-container">
<pre class="src src-shell">sudo apt install openssl
</pre>
</div>

<p>
For the demonstration purpose, let's create a dummy file called <code>secret.txt</code>. We will encrypt this <code>secret.txt</code> file using openssl.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-builtin">echo</span> <span class="org-string">"Hello World"</span> &gt; secret.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orga1e01ec" class="outline-2">
<h2 id="orga1e01ec">Encryption</h2>
<div class="outline-text-2" id="text-orga1e01ec">
<p>
We will be using the <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES 256</a> encryption algorithm to encrypt the file. AES is a symmetric-key encryption algorithm, which means that the same key is used to encrypt as well as decrypt the data. The length of the key can be 128, 192 or 256 bits. We would be using a 256 bit key, hence the algorithm is called <code>AES-256</code>.
</p>

<p>
However we won't be creating any key explicitly, rather, we would provide a passphrase, and openssl will automatically derive the key from the passphrase.
</p>

<p>
To encrypt the <code>secret.txt</code> file into <code>secret.enc.txt</code>, run the following command:
</p>

<div class="org-src-container">
<pre class="src src-shell">openssl aes-256-cbc -e -salt -iter 10000 -pbkdf2 -a -in secret.txt -out secret.enc.txt
</pre>
</div>

<p>
Let's have a look on the options we have used,
</p>

<table>


<colgroup>
<col  class="org-left">

<col  class="org-left">
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Option</th>
<th scope="col" class="org-left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>aes-256-cbc</code></td>
<td class="org-left">the AES-256 algorithm</td>
</tr>

<tr>
<td class="org-left"><code>-e</code></td>
<td class="org-left">this means we want to do encryption</td>
</tr>

<tr>
<td class="org-left"><code>-salt</code></td>
<td class="org-left">read more about <a href="https://en.wikipedia.org/wiki/Salt_(cryptography)">salt (cryptography)</a></td>
</tr>

<tr>
<td class="org-left"><code>-iter 10000</code></td>
<td class="org-left">we want 10,000 iterations to produce the key</td>
</tr>

<tr>
<td class="org-left"><code>-pbkdf2</code></td>
<td class="org-left">passphrase based key derivation function 2</td>
</tr>

<tr>
<td class="org-left"><code>-a</code></td>
<td class="org-left">base64 encode/decode</td>
</tr>

<tr>
<td class="org-left"><code>-md val</code></td>
<td class="org-left">Message digest algorithm</td>
</tr>

<tr>
<td class="org-left"><code>-in val</code></td>
<td class="org-left">our input file</td>
</tr>

<tr>
<td class="org-left"><code>-out val</code></td>
<td class="org-left">our output file</td>
</tr>
</tbody>
</table>

<p>
This will ask for a passphrase. Make sure you remember this passphrase.
Now, you will have a <code>secret.enc.txt</code> encrypted file along side your plain text <code>secret.txt</code> file.
</p>

<p>
We will remove the <code>secret.txt</code> file, which contains our secret message. We used the <code>shred</code> command to overwrite the file and then delete it.
</p>

<div class="org-src-container">
<pre class="src src-shell">shred -fun5 secret.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad4ed79" class="outline-2">
<h2 id="orgad4ed79">Decryption</h2>
<div class="outline-text-2" id="text-orgad4ed79">
<p>
The command for decrypting a file is almost same, except here we use the <code>-d</code> flag (d for decryption), instead of <code>-e</code> (e for encryption), and the input-output files change accordingly.
</p>

<div class="org-src-container">
<pre class="src src-shell">openssl aes-256-cbc -d -salt -iter 10000 -pbkdf2 -a -in secret.enc.txt -out secret.txt
</pre>
</div>

<p>
This will ask for the passphrase. After entering the correct passphrase, a plain text file, <code>secret.txt</code> would be created.
</p>
</div>
</div>

<div id="outline-container-org9411f85" class="outline-2">
<h2 id="org9411f85">Note</h2>
<div class="outline-text-2" id="text-org9411f85">
<p>
This method is used to encrypt one file at a time. If you want to encrypt multiple files in one go, then make a tarball of all the files, and then encrypt the tarball with this method.
</p>
</div>
</div>
</main>
<footer id="postamble" class="status">
<p class="footer-block">
  Copyright &copy 2021-2023 Pushkar Raj. Read the notice about <a href="/license.html">license terms</a>.
</p>
<p class="footer-block">
  Created using <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.1 (<a href="https://orgmode.org">Org</a> mode 9.3)
</p>
</footer>
</body>
</html>
